# 实现完整的属性系统

## 1. 文件结构设计

```
scripts/
├── attributes/
│   ├── playerAttributes.gd    # 玩家属性单例
│   └── attributeTypes.gd       # 属性类型定义
└── utils/
    └── saveManager.gd          # 数据持久化管理器
```

## 2. 核心实现方案

### 2.1 单例实现 - PlayerAttributes.gd

* 使用Godot 4.x AutoLoad功能实现全局单例

* 包含所有属性数据结构：基础信息、身体信息、职业信息

* 提供完整的属性修改方法封装

* 实现年龄自动增长逻辑（绑定时间系统）

* 实现体力消耗/恢复机制

* 实现职业升级逻辑

* 提供清晰的信号机制

### 2.2 数据结构设计

```gdscript
# 基础信息
var daily_expense: int = 0
var daily_income: int = 0
var money: int = 0

# 身体信息
var stamina: int = 100  # 0-100范围
var age: int = 20

# 职业信息
var job_title: String = "初级产品经理"
var level: int = 1
var exp: int = 0
var exp_max: int = 100
var salary: int = 10
```

### 2.3 核心功能实现

#### 2.3.1 年龄自动增长

* 监听时间系统的year\_changed信号

* 每过1年，年龄自动+1

#### 2.3.2 体力机制

* 点击工作消耗固定体力

* 随时间自动恢复体力（每小时恢复一定量）

* 体力范围限制在0-100

#### 2.3.3 职业升级逻辑

* 工作获得经验值

* 经验值满后自动升级

* 升级后更新职业等级、称号和工资

* 经验值上限随等级提升

#### 2.3.4 金钱收支系统

* 工作获得金钱

* 每天自动扣除固定消耗

* 每天自动获得固定收入

* 金钱不能为负

#### 2.3.5 数据持久化

* 实现保存/加载功能

* 支持JSON格式存储

* 自动保存游戏进度

## 3. 与现有代码集成

### 3.1 修改WorkLogic.gd

* 移除现有属性变量

* 使用PlayerAttributes单例管理属性

* 工作按钮点击调用单例方法

* 时间流逝时调用单例方法更新体力和年龄

### 3.2 信号机制

* PlayerAttributes发出属性变化信号

* UI组件监听信号更新显示

## 4. 技术规范

* 所有属性修改通过方法封装，避免直接赋值

* 包含完整的错误处理和边界检查

* 提供清晰的注释和使用示例

* 遵循Godot 4.x最佳实践

* 使用GDScript编写

## 5. 实现步骤

1. 创建attributes和utils目录
2. 实现attributeTypes.gd定义属性类型
3. 实现playerAttributes.gd单例
4. 实现saveManager.gd数据持久化
5. 修改WorkLogic.gd集成属性系统
6. 配置AutoLoad单例
7. 测试所有功能

## 6. 预期效果

* 完整的属性系统，支持年龄增长、体力恢复、职业升级

* 全局可访问的单例，便于扩展

* 清晰的信号机制，便于UI更新

* 数据持久化，支持保存/加载

* 与现有游戏逻辑无缝集成

